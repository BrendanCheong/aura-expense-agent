# Test Plan 06 — End-to-End Tests

> **Layer:** E2E  
> **Runner:** Playwright  
> **Config:** `playwright.config.ts`  
> **Target Coverage:** Critical user paths  
> **Environment:** Local dev server with Appwrite emulation (seeded test data)  
> **References:** [FRONTEND_ARCHITECTURE.md](../plans/FRONTEND_ARCHITECTURE.md), [API_SPECIFICATION.md](../plans/API_SPECIFICATION.md)

---

## Design: E2E Test Setup

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test';

export default defineConfig({
  testDir: './__tests__/e2e',
  timeout: 30_000,
  retries: 1,
  use: {
    baseURL: 'http://localhost:4321',
    screenshot: 'only-on-failure',
    trace: 'on-first-retry',
  },
  webServer: {
    command: 'npm run dev',
    port: 4321,
    reuseExistingServer: !process.env.CI,
  },
});
```

### Auth Helper

```typescript
// __tests__/e2e/helpers/auth.ts
import { Page } from '@playwright/test';

export async function loginAsTestUser(page: Page) {
  // In dev mode, use a test auth endpoint that bypasses OAuth
  await page.goto('/api/auth/test-login?userId=test-user-001');
  await page.waitForURL('/dashboard');
}
```

---

## 1. Authentication Flows

**File:** `__tests__/e2e/auth.spec.ts`

| #   | Test Name                | Steps                     | Expected                                                      |
| --- | ------------------------ | ------------------------- | ------------------------------------------------------------- |
| 1   | Login page renders       | Navigate to `/`           | Shows "Sign in with Google" and "Sign in with GitHub" buttons |
| 2   | Unauthenticated redirect | Navigate to `/dashboard`  | Redirected to `/` login page                                  |
| 3   | Successful login         | Use test auth helper      | Redirected to `/dashboard`, user name visible in header       |
| 4   | Logout                   | Click avatar → "Sign Out" | Redirected to `/`, session cleared                            |

## 2. Dashboard

**File:** `__tests__/e2e/dashboard.spec.ts`

| #   | Test Name                 | Steps                   | Expected                                                  |
| --- | ------------------------- | ----------------------- | --------------------------------------------------------- |
| 5   | Dashboard loads with data | Login → `/dashboard`    | Shows total spent, budget progress, spending chart        |
| 6   | Category breakdown chart  | View donut chart        | 8 segments with correct colors, legend matches categories |
| 7   | Budget progress bars      | View budget section     | Shows bars for each category with percentages             |
| 8   | Over-budget alert banner  | Shopping is over-budget | Red alert banner visible at top                           |
| 9   | Recent transactions list  | View list               | Shows latest 10 transactions sorted by date               |
| 10  | Month navigation          | Click "← January"       | Dashboard updates to January data                         |

## 3. Transactions

**File:** `__tests__/e2e/transactions.spec.ts`

| #   | Test Name                 | Steps                                                         | Expected                                            |
| --- | ------------------------- | ------------------------------------------------------------- | --------------------------------------------------- |
| 11  | Transaction list displays | Navigate to `/transactions`                                   | Shows all 16 test transactions                      |
| 12  | Pagination works          | Click page 2                                                  | Shows next set, no duplicates                       |
| 13  | Filter by category        | Select "Food & Beverage" dropdown                             | Only food transactions shown                        |
| 14  | Filter by date range      | Select "Feb 5 - Feb 10"                                       | Only transactions in range                          |
| 15  | Add manual transaction    | Click "+", fill form (vendor, amount, category, date), submit | New transaction appears in list, toast notification |
| 16  | Edit transaction category | Click tx row → change category to "Entertainment"             | Updated in list, dashboard reflects change          |
| 17  | Edit transaction fields   | Click tx row → edit vendor, amount, date, save                | All fields updated                                  |
| 18  | Give AI feedback          | Click tx row → "Give AI Feedback" → type correction → approve | Category updated, success toast                     |
| 19  | AI feedback multi-round   | Reject first AI proposal → refine feedback → approve          | Conversation maintained, final category applied     |
| 20  | Delete transaction        | Click tx row → "Delete" → confirm                             | Transaction removed, toast notification             |
| 21  | Empty state               | New user with no transactions                                 | Shows "No transactions yet" illustration            |

## 4. Budgets

**File:** `__tests__/e2e/budgets.spec.ts`

| #   | Test Name                | Steps                                           | Expected                                        |
| --- | ------------------------ | ----------------------------------------------- | ----------------------------------------------- |
| 19  | Budget page renders      | Navigate to `/budgets`                          | Shows all 8 category budgets for current month  |
| 20  | Budget shows utilization | View budget row                                 | Shows "$X of $Y spent" with progress bar        |
| 21  | Edit budget amount       | Click "Food & Beverage" → change to $500 → save | Updated amount, progress bar recalculated       |
| 22  | Set budget from salary   | Enter $5,000 salary → allocate                  | Categories show allocation % and dollar amounts |
| 23  | Month navigation         | Switch to March 2026                            | Shows empty budgets or copied from Feb          |

## 5. Categories

**File:** `__tests__/e2e/categories.spec.ts`

| #   | Test Name                         | Steps                                    | Expected                                        |
| --- | --------------------------------- | ---------------------------------------- | ----------------------------------------------- |
| 24  | Category list renders             | Navigate to `/categories`                | Shows 8 default categories                      |
| 25  | Add custom category               | Click "+" → enter "Subscriptions" → save | Category appears in list                        |
| 26  | Delete category with transactions | Delete "Transport" → confirm             | Transactions moved to "Other", category removed |
| 27  | Cannot delete "Other"             | Attempt delete "Other"                   | Delete button disabled or error message         |

---

## CI Pipeline (E2E)

```yaml
# Runs after unit + integration pass
e2e:
  needs: [integration]
  timeout-minutes: 15
  steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '22'
    - run: npm ci
    - run: npx playwright install --with-deps chromium
    - name: Seed test data
      run: npm run db:seed:test
    - name: Run E2E tests
      run: npx playwright test
    - uses: actions/upload-artifact@v4
      if: failure()
      with:
        name: playwright-report
        path: playwright-report/
```

---

## Screenshot Testing (Optional V2)

For future visual regression, Playwright supports screenshot comparison:

```typescript
await expect(page.locator('.budget-chart')).toHaveScreenshot('budget-chart.png', {
  maxDiffPixelRatio: 0.01,
});
```
